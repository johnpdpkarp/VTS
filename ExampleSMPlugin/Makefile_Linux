###############################################################################
#
#     FILENAME:   Makefile_Linux
#
#     DESCRIPTION:
#
#     This Makefile is used by make to build the vts ExampleSMPlugin plugin 
#     (shared object) on Solaris using the gcc compiler.
#
#     NOTES:
#
###############################################################################

CXX = g++ 

VTSPROJDIR = ..
CSMINCDIR = $(VTSPROJDIR)/CSM_include

OBJDIR = $(VTSPROJDIR)/ExampleSMPlugin/object_gcc

LIBPATH = ExampleSMPlugin/library_gcc
LIBDIR = $(VTSPROJDIR)/$(LIBPATH)
LNKLIBDIR = ./$(LIBPATH)

# The flags needed to compile all
CXXFLAGS = -g -Wall
CSHAREDFLAGS = -shared

# we need to link in the dll handling library

LDLIBS =	-ldl -lCstd

#------------------------------------------------------------------------------
all : $(LIBDIR)/ExampleSMPlugin.so
	(cd $(VTSPROJDIR);rm -f ExampleSMPlugin.so; \
         ln -s $(LNKLIBDIR)/ExampleSMPlugin.so .)

#------------------------------------------------------------------------------
# "copy" is the same as "all" except the actual ".so" is copied to the
#        top-level directory instead of generating a link.

copy : $(LIBDIR)/ExampleSMPlugin.so
	(cd $(VTSPROJDIR);rm -f ExampleSMPlugin.so; \
         cp $(LNKLIBDIR)/ExampleSMPlugin.so .)

#------------------------------------------------------------------------------
$(LIBDIR)/ExampleSMPlugin.so : $(OBJDIR)/ExampleSMPlugin.o \
                               $(OBJDIR)/ExampleSensorModel.o
	$(CXX)  -shared $(CXXFLAGS)  $(OBJDIR)/ExampleSMPlugin.o \
        $(OBJDIR)/ExampleSensorModel.o \
	-o $(LIBDIR)/ExampleSMPlugin.so

#------------------------------------------------------------------------------
$(OBJDIR)/ExampleSMPlugin.o : ExampleSMPlugin.cpp \
	Makefile_Linux \
	ExampleSMPlugin.h \
	ExampleSensorModel.h \
	$(CSMINCDIR)/CSMPlugin.h \
	$(CSMINCDIR)/CSMError.h \
	$(CSMINCDIR)/CSMWarning.h \
	$(CSMINCDIR)/CSMMisc.h
	$(CXX) -c -g $(TSTAPIVER) -I$(CSMINCDIR) ExampleSMPlugin.cpp \
               -o $(OBJDIR)/ExampleSMPlugin.o

#------------------------------------------------------------------------------
$(OBJDIR)/ExampleSensorModel.o : ExampleSensorModel.cpp \
	Makefile_Linux \
	ExampleSensorModel.h \
	$(CSMINCDIR)/CSMSensorModel.h \
	$(CSMINCDIR)/CSMError.h \
	$(CSMINCDIR)/CSMWarning.h
	$(CXX) -c -g $(TSTAPIVER) -I$(CSMINCDIR) ExampleSensorModel.cpp \
               -o $(OBJDIR)/ExampleSensorModel.o

#------------------------------------------------------------------------------
clean :
	-rm -f $(OBJDIR)/*.o vts $(LIBDIR)/*.so \
             $(VTSPROJDIR)/ExampleSMPlugin.so *~
	-rm -rf SunWS_cache

