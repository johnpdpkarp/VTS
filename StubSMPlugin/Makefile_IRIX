###############################################################################
#
#     FILENAME:   Makefile_IRIX
#
#     DESCRIPTION:
#
#     This Makefile is used by make to build the vts StubSMPlugin plugin
#     (shared object) on Solaris using the gcc compiler.
#
#     NOTES:
#
###############################################################################

CXX = g++

VTSPROJDIR = ..
CSMINCDIR = $(VTSPROJDIR)/CSM_include
VTSINCDIR = $(VTSPROJDIR)/VTS_include

OBJDIR = $(VTSPROJDIR)/StubSMPlugin/object

LIBPATH = StubSMPlugin/library
LIBDIR = $(VTSPROJDIR)/$(LIBPATH)
LNKLIBDIR = ./$(LIBPATH)

# The flags needed to compile all
CXXFLAGS = -g -Wall
CSHAREDFLAGS = -shared

# we need to link in the dll handling library

LDLIBS =	-ldl -lCstd

#------------------------------------------------------------------------------
all : $(LIBDIR)/StubSMPlugin.so 
	(cd $(VTSPROJDIR);rm -f StubSMPlugin.so; \
         ln -s $(LNKLIBDIR)/StubSMPlugin.so .)

#------------------------------------------------------------------------------
# "copy" is the same as "all" except the actual ".so" is copied to the
#        top-level directory instead of generating a link.

copy : $(LIBDIR)/StubSMPlugin.so 
	(cd $(VTSPROJDIR);rm -f StubSMPlugin.so; \
         cp $(LNKLIBDIR)/StubSMPlugin.so .)

#------------------------------------------------------------------------------
$(LIBDIR)/StubSMPlugin.so : $(OBJDIR)/StubSMPlugin.o $(OBJDIR)/StubSensorModel.o
	$(CXX)  -shared $(CXXFLAGS)   $(OBJDIR)/StubSMPlugin.o \
        $(OBJDIR)/StubSensorModel.o \
	-o $(LIBDIR)/StubSMPlugin.so

#------------------------------------------------------------------------------
$(OBJDIR)/StubSMPlugin.o : StubSMPlugin.cpp \
	Makefile_IRIX \
	StubSensorModel.h \
	StubSMPlugin.h \
	$(CSMINCDIR)/CSMPlugin.h \
	$(CSMINCDIR)/CSMError.h \
	$(CSMINCDIR)/CSMWarning.h \
	$(CSMINCDIR)/CSMMisc.h
	$(CXX) -c -g $(TSTAPIVER) -I$(CSMINCDIR) StubSMPlugin.cpp \
               -o $(OBJDIR)/StubSMPlugin.o

#------------------------------------------------------------------------------
$(OBJDIR)/StubSensorModel.o : StubSensorModel.cpp \
	Makefile_IRIX \
	StubSensorModel.h \
	$(CSMINCDIR)/CSMSensorModel.h \
	$(VTSINCDIR)/VTSMisc.h
	$(CXX) -c -g $(TSTAPIVER) -I$(CSMINCDIR) -I$(VTSINCDIR) StubSensorModel.cpp \
	-o $(OBJDIR)/StubSensorModel.o

#------------------------------------------------------------------------------
clean :
	-rm -f $(OBJDIR)/*.o vts $(LIBDIR)/*.so $(VTSPROJDIR)/StubSMPlugin.so *~
	-rm -rf SunWS_cache

