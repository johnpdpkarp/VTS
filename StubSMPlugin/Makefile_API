###############################################################################
#
#     FILENAME:   Makefile_API
#
#     DESCRIPTION:
#
#     This Makefile is used by make to build the vts StubSMPlugin plugin
#     (shared object) on Solaris using the WorkShop/Forte CC compiler.
#
#     NOTES:
#
###############################################################################

CXX = CC

VTSPROJDIR = ..
CSMINCDIR = $(VTSPROJDIR)/CSM_include
VTSINCDIR = $(VTSPROJDIR)/VTS_include

OBJDIR = $(VTSPROJDIR)/StubSMPlugin/object

LIBPATH = StubSMPlugin/library
LIBDIR = $(VTSPROJDIR)/$(LIBPATH)
LNKLIBDIR = ./$(LIBPATH)

# The flags needed to compile all
CXXFLAGS =	-PIC -g -DTESTAPIVERSION

# we need to link in the dll handling library

LDLIBS =	-ldl -lCstd

#------------------------------------------------------------------------------
all : $(LIBDIR)/StubSMPlugin2.so 
	(cd $(VTSPROJDIR);rm -f StubSMPlugin2.so; \
         ln -s $(LNKLIBDIR)/StubSMPlugin2.so .)

#------------------------------------------------------------------------------
# "copy" is the same as "all" except the actual ".so" is copied to the
#        top-level directory instead of generating a link.

copy : $(LIBDIR)/StubSMPlugin2.so 
	(cd $(VTSPROJDIR);rm -f StubSMPlugin2.so; \
         cp $(LNKLIBDIR)/StubSMPlugin2.so .)

#------------------------------------------------------------------------------
$(LIBDIR)/StubSMPlugin2.so : $(OBJDIR)/StubSMPlugin2.o $(OBJDIR)/StubSensorModel2.o
	$(CXX)  -G $(CXXFLAGS)   $(OBJDIR)/StubSMPlugin2.o \
        $(OBJDIR)/StubSensorModel2.o \
	-o $(LIBDIR)/StubSMPlugin2.so 

#------------------------------------------------------------------------------
$(OBJDIR)/StubSMPlugin2.o : StubSMPlugin.cpp \
	Makefile_API \
	StubSensorModel.h \
	StubSMPlugin.h \
	$(CSMINCDIR)/CSMPlugin.h \
	$(CSMINCDIR)/CSMError.h \
	$(CSMINCDIR)/CSMWarning.h \
	$(CSMINCDIR)/CSMMisc.h \
	$(CSMINCDIR)/CSMCovarianceModel.h
	$(CXX) -c $(CXXFLAGS) $(TSTAPIVER) -I$(CSMINCDIR) StubSMPlugin.cpp \
               -o $(OBJDIR)/StubSMPlugin2.o

#------------------------------------------------------------------------------
$(OBJDIR)/StubSensorModel2.o : StubSensorModel.cpp \
	Makefile_API \
	StubSensorModel.h \
	$(CSMINCDIR)/CSMSensorModel.h \
	$(CSMINCDIR)/CSMCovarianceModel.h \
	$(VTSINCDIR)/VTSMisc.h
	$(CXX) -c $(CXXFLAGS) $(TSTAPIVER) -I$(CSMINCDIR) -I$(VTSINCDIR) StubSensorModel.cpp \
	-o $(OBJDIR)/StubSensorModel2.o

#------------------------------------------------------------------------------
clean :
	-rm -f $(OBJDIR)/*.o vts $(LIBDIR)/*.so $(VTSPROJDIR)/StubSMPlugin2.so *~
	-rm -rf SunWS_cache

