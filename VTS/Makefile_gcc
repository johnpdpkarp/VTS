###############################################################################
#
#     FILENAME:   Makefile_gcc
#
#     DESCRIPTION:
#
#     This Makefile is used by make to build the vts application and
#     supporting code on Solaris using the gcc compiler.
#
#     NOTES:
#
###############################################################################

CXX = g++ 

VTSPROJDIR = ..

CSMINCDIR = $(VTSPROJDIR)/CSM_include
CSMDIR = $(VTSPROJDIR)/CSM
CSMOBJDIR = $(VTSPROJDIR)/CSM/object_gcc

VTSINCDIR = $(VTSPROJDIR)/VTS_include
VTSOBJDIR = $(VTSPROJDIR)/VTS/object_gcc

BINPATH = VTS/binary_gcc
VTSBINDIR = $(VTSPROJDIR)/$(BINPATH)
LNKBINDIR = ./$(BINPATH)

# The flags needed to compile all
CXXFLAGS = -c -g -D_FILE_OFFSET_BITS=64
CSHAREDFLAGS = -shared

# we need to link in the dll handling library

LDLIBS =	-ldl 

#------------------------------------------------------------------------------
all : $(VTSBINDIR)/vts
	(cd $(VTSPROJDIR); rm -f vts; ln -s $(LNKBINDIR)/vts .)

# the main executable has to be linked with the -rdynamic flag
# so the plug in libraries can call inherited methods and
# access vtables in the main executable.

#------------------------------------------------------------------------------
# "copy" is the same as "all" except the actual executable is copied to the
#        top-level directory instead of generating a link.

copy : $(VTSBINDIR)/vts
	(cd $(VTSPROJDIR); rm -f vts; cp $(LNKBINDIR)/vts .)

#------------------------------------------------------------------------------
$(VTSBINDIR)/vts :   $(VTSOBJDIR)/vts.o \
	$(VTSOBJDIR)/compareParam.o \
	$(VTSOBJDIR)/recordLog.o \
	$(VTSOBJDIR)/SMManager.o \
	$(VTSOBJDIR)/tokenizer.o \
	$(VTSOBJDIR)/vts_isd.o \
	$(VTSOBJDIR)/vts_misc.o \
	$(VTSOBJDIR)/tinyxml.o       \
	$(VTSOBJDIR)/SensorModelThreadSafe.o       \
	$(CSMOBJDIR)/CSMPlugin.o 
	$(CXX) -lpthread -g $(VTSOBJDIR)/vts.o \
		$(VTSOBJDIR)/vts_misc.o \
		$(VTSOBJDIR)/vts_isd.o \
		$(VTSOBJDIR)/SMManager.o \
		$(VTSOBJDIR)/compareParam.o \
		$(VTSOBJDIR)/recordLog.o \
		$(VTSOBJDIR)/tokenizer.o \
		$(VTSOBJDIR)/tinyxml.o       \
		$(VTSOBJDIR)/SensorModelThreadSafe.o       \
		$(CSMOBJDIR)/CSMPlugin.o \
		-o $(VTSBINDIR)/vts  $(LDLIBS)

# -rdynamic

#------------------------------------------------------------------------------
$(VTSOBJDIR)/vts.o : vts.cpp \
	Makefile_gcc \
	$(CSMINCDIR)/CSMPlugin.h \
	$(CSMINCDIR)/CSMError.h \
	$(CSMINCDIR)/CSMWarning.h \
	$(CSMINCDIR)/CSMSensorModel.h \
	$(CSMINCDIR)/CSMImageSupportData.h \
	$(CSMINCDIR)/CSMISDNITF20.h \
	$(CSMINCDIR)/CSMISDNITF21.h \
	$(CSMINCDIR)/CSMISDFilename.h \
	$(CSMINCDIR)/CSMISDByteStream.h \
	$(VTSINCDIR)/SMManager.h \
	$(VTSINCDIR)/VTSMisc.h \
	$(VTSINCDIR)/tinyxml.h \
	$(VTSINCDIR)/constants.h \
	$(VTSINCDIR)/tokenizer.h
	$(CXX) $(CXXFLAGS) $(TSTAPIVER) -I$(CSMINCDIR) -I$(VTSINCDIR) vts.cpp \
	-o $(VTSOBJDIR)/vts.o

$(VTSOBJDIR)/SMManager.o    : SMManager.cpp \
	Makefile_gcc \
	$(VTSINCDIR)/SMManager.h \
	$(CSMINCDIR)/CSMPlugin.h \
	$(CSMINCDIR)/CSMError.h \
	$(CSMINCDIR)/CSMWarning.h
	$(CXX) $(CXXFLAGS) -I$(CSMINCDIR) -I$(VTSINCDIR) SMManager.cpp \
		-o $(VTSOBJDIR)/SMManager.o

$(CSMOBJDIR)/CSMPlugin.o    :
	( cd $(CSMDIR);make -f Makefile_gcc)

$(VTSOBJDIR)/compareParam.o    : compareParam.cpp \
	Makefile_gcc \
	$(CSMINCDIR)/CSMMisc.h \
	$(VTSINCDIR)/VTSMisc.h
	$(CXX) $(CXXFLAGS) -I$(CSMINCDIR) -I$(VTSINCDIR) compareParam.cpp \
		-o $(VTSOBJDIR)/compareParam.o

$(VTSOBJDIR)/recordLog.o    : recordLog.cpp \
	Makefile_gcc \
	$(CSMINCDIR)/CSMError.h \
	$(CSMINCDIR)/CSMWarning.h \
	$(CSMINCDIR)/CSMISDFilename.h \
	$(CSMINCDIR)/CSMISDByteStream.h \
	$(CSMINCDIR)/CSMISDNITF20.h \
	$(CSMINCDIR)/CSMISDNITF21.h \
	$(VTSINCDIR)/VTSMisc.h
	$(CXX) $(CXXFLAGS) -I$(CSMINCDIR) -I$(VTSINCDIR) recordLog.cpp \
		-o $(VTSOBJDIR)/recordLog.o

$(VTSOBJDIR)/vts_isd.o      : vts_isd.cpp \
	Makefile_gcc \
	$(CSMINCDIR)/CSMError.h \
	$(CSMINCDIR)/CSMWarning.h \
	$(CSMINCDIR)/CSMImageSupportData.h \
	$(CSMINCDIR)/CSMISDFilename.h \
	$(CSMINCDIR)/CSMISDByteStream.h \
	$(CSMINCDIR)/CSMISDNITF20.h \
	$(CSMINCDIR)/CSMISDNITF21.h \
	$(VTSINCDIR)/VTSMisc.h
	$(CXX) $(CXXFLAGS) -I$(CSMINCDIR) -I$(VTSINCDIR) vts_isd.cpp \
		-o $(VTSOBJDIR)/vts_isd.o

$(VTSOBJDIR)/vts_misc.o     : vts_misc.cpp \
	Makefile_gcc \
	$(CSMINCDIR)/CSMError.h \
	$(CSMINCDIR)/CSMWarning.h \
	$(CSMINCDIR)/CSMImageSupportData.h \
	$(CSMINCDIR)/CSMPlugin.h \
	$(VTSINCDIR)/VTSMisc.h
	$(CXX) $(CXXFLAGS) -I$(CSMINCDIR) -I$(VTSINCDIR) vts_misc.cpp \
		-o $(VTSOBJDIR)/vts_misc.o
$(VTSOBJDIR)/tokenizer.o        : tokenizer.cpp $(VTSINCDIR)/tokenizer.h Makefile_gcc
	$(CXX) $(CXXFLAGS)  -I$(VTSINCDIR) tokenizer.cpp -o $(VTSOBJDIR)/tokenizer.o

$(VTSOBJDIR)/SensorModelThreadSafe.o      : SensorModelThreadSafe.cpp \
	Makefile_gcc \
	$(CSMINCDIR)/CSMError.h \
	$(CSMINCDIR)/CSMWarning.h \
	$(VTSINCDIR)/VTSMisc.h \
	$(VTSINCDIR)/tinyxml.h
	$(CXX) $(CXXFLAGS) -I$(CSMINCDIR) -I$(VTSINCDIR) SensorModelThreadSafe.cpp \
	-o $(VTSOBJDIR)/SensorModelThreadSafe.o

$(VTSOBJDIR)/tinyxml.o    : tinyxml.cpp $(VTSINCDIR)/tinyxml.h Makefile_gcc
	$(CXX) $(CXXFLAGS) -I$(CSMINCDIR) -I$(VTSINCDIR) tinyxml.cpp -o $(VTSOBJDIR)/tinyxml.o

#------------------------------------------------------------------------------
clean :
	-rm -f $(VTSOBJDIR)/*.o $(VTSBINDIR)/vts $(VTSPROJDIR)/vts *.so *~
	-rm -rf SunWS_cache

